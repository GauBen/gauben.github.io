<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>La stack parfaite · Gautier Ben Aïm</title><meta name="description" content="Et si la meilleure façon de créer un site était de combiner un générateur de site statique et un bundler ?"><link rel="stylesheet" href="/404.94b13657.css"><link rel="stylesheet" href="/blog/2021-05-10-guide-graphique-un-article-au-titre-beaucoup-trop-long/index.dad68e9b.css"><link rel="icon shortcut" href="/favicon.f6b5eb08.ico" type="image/x-icon"><link rel="manifest" href="/up_/assets/app.webmanifest"><meta property="og:image" content="/portfolio.50b1f99e.png"></head><body> <nav class="site-nav"> <ul><li><a href="/fr/">Accueil</a></li> <li><a href="/fr/blog/">Blog</a></li> <li><a href="/fr/about/">À propos</a></li></ul> </nav> <main> <h1 class="section-title">La stack parfaite</h1> <div class="markdown-body"> <div class="_sticky-wrapper -left"> <aside class="post-aside"> <p class="description">Et si la meilleure façon de créer un site était de combiner un générateur de site statique et un bundler ?</p> <img src="/me.92881bbb.jpg" alt="A picture of me" class="picture" width="48" height="48"> <p class="meta"> <strong>Gautier</strong> · <time datetime="2021-05-21T00:00:00Z">21 mai 2021</time> · 1163 mots </p> <ul class="tag-list"><li class="tag"> <span class="span">Eleventy</span> </li><li class="tag"> <span class="span">Parcel</span> </li> </ul> </aside> </div> <nav class="table-of-contents"> <div class="toc"> <ol><li><a href="#introduction"> Introduction</a></li><li><a href="#eleventy-et-parcel"> Eleventy et Parcel</a><ol><li><a href="#eleventy"> Eleventy</a></li><li><a href="#parcel"> Parcel</a></li><li><a href="#assemblage-des-deux"> Assemblage des deux</a></li></ol></li><li><a href="#avantages-dun-site-statique"> Avantages d’un site statique</a></li><li><a href="#déploiement-continu"> Déploiement continu</a></li></ol></div> </nav> <h2 id="introduction"><a class="header-anchor" href="#introduction"> #</a> Introduction</h2> <p>Mon portfolio – le site sur lequel vous êtes en ce moment même – est un petit site statique qui présente mes projets et contient quelques articles de blog.</p> <p>Sa conception a commencé en 2020. Comme GitHub pages ne proposait pas de backend, et parce que la mode s’installait, j’ai cherché un <strong>générateur de site statique</strong> pour développer un site léger rapidement. Le site <a href="https://jamstack.org/generators/">Jamstack</a> offre un très beau comparateur, avec plus de 300 générateurs répertoriés. Après de longues et tumultueuses recherches sur les Internets pour trouver <em>le</em> meilleur générateur, mon dévolu s’est jeté sur <a href="https://www.11ty.dev/">Eleventy</a>. Ce qui m’a convaincu, c’est qu’il est codé en JavaScript, qu’il supporte les <em>templates</em> en Markdown et Nunjucks, fonctionne sans configuration et qu’il a été mentionné plusieurs fois sur CSS-Tricks.</p> <p>Par ailleurs, comme plus personne n’écrit de JS et CSS à la main, il me fallait un outil pour compiler du TypeScript et du Stylus. Là encore, j’ai favorisé un outil qui fonctionne sans configuration : <a href="https://parceljs.org/">Parcel</a>.</p> <h2 id="eleventy-et-parcel"><a class="header-anchor" href="#eleventy-et-parcel"> #</a> Eleventy et Parcel</h2> <p>Si vous ne les connaissez pas encore, laissez-moi vous faire une rapide présentation de ces outils.</p> <h3 id="eleventy"><a class="header-anchor" href="#eleventy"> #</a> Eleventy</h3> <p>Eleventy est un générateur de site statique qui se veut simple : son but est de produire des pages HTML à partir de fichiers qui contiennent des données (appelés <em>templates</em>) et le squelette du site. Voici un exemple pour montrer la simplicité et la puissance de l’outil en trois fichiers et quelques lignes.</p> <p>Fichier <strong>index.md</strong> :</p> <pre class="language-md"><code class="language-md"><span class="front-matter-block token"><span class="punctuation token">---</span><br><span class="font-matter language-yaml token yaml">title: Accueil<br>layout: html.njk</span><br><span class="punctuation token">---</span></span><br><br><span class="important title token"><span class="punctuation token">#</span> Bienvenue sur mon site !</span><br><br><span class="token url">[<span class="content token">En savoir plus sur moi</span>](<span class="token url">/about/</span>)</span></code></pre> <p>Fichier <strong>about.md</strong> :</p> <pre class="language-md"><code class="language-md"><span class="front-matter-block token"><span class="punctuation token">---</span><br><span class="font-matter language-yaml token yaml">title: À propos<br>layout: html.njk</span><br><span class="punctuation token">---</span></span><br><br><span class="important title token"><span class="punctuation token">#</span> À propos de moi</span><br><br>Salut, je suis <span class="bold token"><span class="punctuation token">**</span><span class="content token">Gaston Lagaffe</span><span class="punctuation token">**</span></span>, champion du monde de sieste.<br><span class="token url">[<span class="content token">Retourner à l'accueil</span>](<span class="token url">/</span>)</span></code></pre> <p>Fichier <strong>_includes/html.njk</strong> (fichier <em>nunjucks</em>) :</p> <pre class="language-jinja2"><code class="language-jinja2"><span class="doctype token"><span class="punctuation token">&lt;!</span><span class="doctype-tag token">DOCTYPE</span> <span class="name token">html</span><span class="punctuation token">></span></span><br><span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>html</span> <span class="attr-name token">lang</span><span class="attr-value token"><span class="attr-equals punctuation token">=</span><span class="punctuation token">"</span>fr<span class="punctuation token">"</span></span><span class="punctuation token">></span></span><br>  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>head</span><span class="punctuation token">></span></span><br>    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>meta</span> <span class="attr-name token">charset</span><span class="attr-value token"><span class="attr-equals punctuation token">=</span><span class="punctuation token">"</span>UTF-8<span class="punctuation token">"</span></span><span class="punctuation token">></span></span><br>    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>title</span><span class="punctuation token">></span></span><span class="jinja2 language-jinja2 token"><span class="delimiter punctuation token">{{</span> <span class="token variable">title</span> <span class="delimiter punctuation token">}}</span></span><span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>title</span><span class="punctuation token">></span></span><br>  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>head</span><span class="punctuation token">></span></span><br>  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>body</span><span class="punctuation token">></span></span><br>    <span class="jinja2 language-jinja2 token"><span class="delimiter punctuation token">{{</span> <span class="token variable">content</span> <span class="operator token">|</span> <span class="token variable">safe</span> <span class="delimiter punctuation token">}}</span></span><br>    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>hr</span><span class="punctuation token">></span></span><br>    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>footer</span><span class="punctuation token">></span></span>2021 · Gaston Lagaffe<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>footer</span><span class="punctuation token">></span></span><br>  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>body</span><span class="punctuation token">></span></span><br><span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>html</span><span class="punctuation token">></span></span></code></pre> <p>En appelant <code>npx eleventy</code> dans une console, la structure de dossier suivante est créée :</p> <ul> <li>_site/ <ul> <li>index.html</li> <li>about/ <ul> <li>index.html</li> </ul> </li> </ul> </li> </ul> <p>Les deux pages contiennent le texte converti en HTML puis intégré au squelette, de même que la variable <code>title</code> de l’en-tête qui est transmise au squelette.</p> <p>Par ailleurs, la <a href="https://www.11ty.dev/docs/getting-started/">documentation</a> est très complète, agréable à lire et en pente douce, ce qui permet de s’y mettre facilement.</p> <h3 id="parcel"><a class="header-anchor" href="#parcel"> #</a> Parcel</h3> <p>Parcel est un <em>bundler</em>, que l’on pourraît traduire en français par empaqueteur : Parcel se charge de rassembler et compiler toutes les dépendances d’une page HTML. Sa puissance réside dans le fait qu’il sait travailler avec de très nombreux formats de code, sans configuration.</p> <p>Par exemple, pour un fichier HTML comme celui-ci, Parcel va compiler les fichiers <code>.styl</code> et <code>.ts</code> pour produire une feuille de style et un script usuel, avec support du rafraîchissement à la sauvegarde et d’autres fonctionnalités. Et la seule commande à taper est <code>npx parcel index.html</code> !</p> <pre class="language-html"><code class="language-html"><span class="highlight-line"><span class="doctype token"><span class="punctuation token">&lt;!</span><span class="doctype-tag token">DOCTYPE</span> <span class="name token">html</span><span class="punctuation token">></span></span></span><br><span class="highlight-line"><span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>html</span> <span class="attr-name token">lang</span><span class="attr-value token"><span class="attr-equals punctuation token">=</span><span class="punctuation token">"</span>en<span class="punctuation token">"</span></span><span class="punctuation token">></span></span></span><br><span class="highlight-line">  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>head</span><span class="punctuation token">></span></span></span><br><span class="highlight-line">    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>meta</span> <span class="attr-name token">charset</span><span class="attr-value token"><span class="attr-equals punctuation token">=</span><span class="punctuation token">"</span>UTF-8<span class="punctuation token">"</span></span><span class="punctuation token">></span></span></span><br><span class="highlight-line">    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>title</span><span class="punctuation token">></span></span>Document<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>title</span><span class="punctuation token">></span></span></span><br><mark class="highlight-line highlight-line-active">    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>link</span> <span class="attr-name token">rel</span><span class="attr-value token"><span class="attr-equals punctuation token">=</span><span class="punctuation token">"</span>stylesheet<span class="punctuation token">"</span></span> <span class="attr-name token">href</span><span class="attr-value token"><span class="attr-equals punctuation token">=</span><span class="punctuation token">"</span>design.styl<span class="punctuation token">"</span></span><span class="punctuation token">></span></span></mark><br><span class="highlight-line">  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>head</span><span class="punctuation token">></span></span></span><br><span class="highlight-line">  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>body</span><span class="punctuation token">></span></span></span><br><span class="highlight-line">    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>h1</span><span class="punctuation token">></span></span>Hello World!<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>h1</span><span class="punctuation token">></span></span></span><br><mark class="highlight-line highlight-line-active">    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>script</span> <span class="attr-name token">src</span><span class="attr-value token"><span class="attr-equals punctuation token">=</span><span class="punctuation token">"</span>main.ts<span class="punctuation token">"</span></span><span class="punctuation token">></span></span><span class="script token"></span><span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>script</span><span class="punctuation token">></span></span></mark><br><span class="highlight-line">  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>body</span><span class="punctuation token">></span></span></span><br><span class="highlight-line"><span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>html</span><span class="punctuation token">></span></span></span></code></pre> <h3 id="assemblage-des-deux"><a class="header-anchor" href="#assemblage-des-deux"> #</a> Assemblage des deux</h3> <p>Ainsi, en utilisant Eleventy et Parcel ensemble, <strong>il est possible de faire un site en entier à base de Markdown, Stylus et TypeScript, sans configuration !</strong><sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup></p> <pre class="mermaid">flowchart LR
    subgraph E ["Eleventy (static site generator)"]
      .md & .njk --> A[.html]
    end
    subgraph C ["Compilation"]
        .styl --> .css
        .ts --> .js
    end
    subgraph P ["Parcel (bundler)"]
        /assets -->|input| C -->|linked| B[.html]
    end
    /pages -->|input| E -->|output| /.pre-dist
    /static -->|copied| /.dist
    /.pre-dist -->|input| P -->|output| /.dist</pre><p>Voici ce que j’appelle <em>la stack parfaite</em>. Ce schéma explique l’intégralité du processus qui permet de produire le site que vous êtes en train de lire :</p> <ul> <li>Eleventy produit des pages HTML à partir de Markdown et de Nunjucks ;</li> <li>Parcel produit un site complet à partir des pages et des <em>assets</em> aux formats TypeScript et Stylus.</li> </ul> <p>Si j’ai pas réussi à vous convaincre, j’ai préparé un <a href="https://github.com/GauBen/11parcels">petit template GitHub</a> où tout est déjà prêt !</p> <h2 id="avantages-dun-site-statique"><a class="header-anchor" href="#avantages-dun-site-statique"> #</a> Avantages d’un site statique</h2> <p>N’avoir un site composé que de pages HTML lui assure <strong>une vitesse et une sécurité inégalable</strong> : pas de <em>backend</em>, pas de base de données, pas de redirections… Juste des pages servies instantanément. Ainsi, ce site a un score parfait sur <a href="https://web.dev/measure/">Lighthouse</a> et <a href="https://yellowlab.tools/">Yellow Lab Tools</a>. (Deux adresses à connaître pour améliorer la qualité d’un site.)</p> <p>Par contre, certaines fonctionnalités ne sont pas possibles sur un site statique ; c’est la raison pour laquelle les commentaires sont gérés par <a href="https://utteranc.es/">Utterances</a>, qui se sert d’<em>issues</em> GitHub pour émuler des discussions. D’ailleurs, n’hésitez pas à <s>ouvrir une issue</s> laisser un <a href="#comments">commentaire</a>.</p> <h2 id="déploiement-continu"><a class="header-anchor" href="#déploiement-continu"> #</a> Déploiement continu</h2> <p>Ce blog est développé sur un git hébergé par GitHub, et GitHub offre une fonctionnalité qui s’appelle les <a href="https://github.com/features/actions">actions</a>. Ce sont des scripts lancés lors d’évènements, comme par exemple un commit poussé. Ainsi, avec les instructions suivantes, le blog est recontruit à chaque commit.</p> <pre class="language-yaml"><code class="language-yaml"><span class="atrule key token">name</span><span class="punctuation token">:</span> Publish<br><span class="atrule key token">on</span><span class="punctuation token">:</span><br>  <span class="atrule key token">push</span><span class="punctuation token">:</span><br>    <span class="atrule key token">branches</span><span class="punctuation token">:</span><br>      <span class="punctuation token">-</span> main<br>  <span class="atrule key token">workflow_dispatch</span><span class="punctuation token">:</span> <span class="important null token">~</span><br><br><span class="atrule key token">jobs</span><span class="punctuation token">:</span><br>  <span class="atrule key token">build_deploy</span><span class="punctuation token">:</span><br>    <span class="atrule key token">name</span><span class="punctuation token">:</span> Build and Deploy<br>    <span class="atrule key token">runs-on</span><span class="punctuation token">:</span> ubuntu<span class="punctuation token">-</span>latest<br>    <span class="atrule key token">steps</span><span class="punctuation token">:</span><br>      <span class="punctuation token">-</span> <span class="atrule key token">name</span><span class="punctuation token">:</span> Checkout<br>        <span class="atrule key token">uses</span><span class="punctuation token">:</span> actions/checkout@v2<br>      <span class="punctuation token">-</span> <span class="atrule key token">name</span><span class="punctuation token">:</span> Setup Node.js environment<br>        <span class="atrule key token">uses</span><span class="punctuation token">:</span> volta<span class="punctuation token">-</span>cli/action@v1<br>      <span class="punctuation token">-</span> <span class="atrule key token">name</span><span class="punctuation token">:</span> Install<br>        <span class="atrule key token">run</span><span class="punctuation token">:</span> yarn install<br>      <span class="punctuation token">-</span> <span class="atrule key token">name</span><span class="punctuation token">:</span> Build<br>        <span class="atrule key token">run</span><span class="punctuation token">:</span> yarn build<br>      <span class="punctuation token">-</span> <span class="atrule key token">name</span><span class="punctuation token">:</span> Deploy<br>        <span class="atrule key token">uses</span><span class="punctuation token">:</span> peaceiris/actions<span class="punctuation token">-</span>gh<span class="punctuation token">-</span>pages@v3<br>        <span class="atrule key token">with</span><span class="punctuation token">:</span><br>          <span class="atrule key token">github_token</span><span class="punctuation token">:</span> $<span class="punctuation token">{</span><span class="punctuation token">{</span> secrets.GITHUB_TOKEN <span class="punctuation token">}</span><span class="punctuation token">}</span><br>          <span class="atrule key token">publish_dir</span><span class="punctuation token">:</span> ./.dist<br>          <span class="atrule key token">publish_branch</span><span class="punctuation token">:</span> gh<span class="punctuation token">-</span>pages</code></pre> <p>Si vous souhaitez en savoir plus sur le fonctionnement exact de ce blog, <a href="https://github.com/GauBen/gauben.github.io">il est entièrement open-source</a> !</p> <hr class="footnotes-sep"> <section class="footnotes"> <ol class="footnotes-list"> <li id="fn1" class="footnote-item"><p>Si vous consultez les fichiers de configuration d’<a href="https://github.com/GauBen/gauben.github.io/blob/main/.eleventy.js">Eleventy</a> et <a href="https://github.com/GauBen/gauben.github.io/blob/main/.parcelrc">Parcel</a> pour ce blog, vous seriez peut-être surpris par leur longueur… Mais rien de tout cela n’était nécessaire au début du site, et le plus long de tout ce code permet d’avoir un site en plusieurs langues. Il est tout à fait possible d’avoir un blog simple sans fichiers de config. <a href="#fnref1" class="footnote-backref">↩︎</a></p> </li> </ol> </section> </div> </main> <nav class="adjacent-posts"> </nav> <section class="comment-section"> <h2 id="comments" class="section-title">Commentaires</h2> <script src="https://utteranc.es/client.js" repo="GauBen/gauben.github.io" issue-term="pathname" label="comment thread" theme="github-light" crossorigin async></script> </section> <footer class="_beautiful-links page-footer"> <p>Cette page est disponible en : <strong>Français</strong>.</p> <p>2021 · Gautier Ben Aïm · CC BY SA 4.0</p> <p>J&#39;aime le minimalisme.</p> <p> <button id="dark-toggle" class="ghost-button">👀</button> </p> </footer> <script type="module">const t=document.querySelector("#dark-toggle");let e=!1;const r=c=>{e=c,localStorage.dark=String(c),t.textContent=document.documentElement.classList.toggle("-dark",c)?"🌞":"🌙";const a=document.querySelector("iframe.utterances-frame");if(null!==a)try{a.contentWindow.postMessage({type:"set-theme",theme:e?"github-dark":"github-light"},"https://utteranc.es")}catch{a.addEventListener("load",(()=>{r(e)}))}const n=document.querySelector('script[src="https://utteranc.es/client.js"]');null!==n&&n.setAttribute("theme",e?"github-dark":"github-light")};null!==localStorage.getItem("dark")?r("true"===localStorage.getItem("dark")):window.matchMedia("(prefers-color-scheme: dark)").matches?r(!0):r(!1),t.addEventListener("click",(()=>{r(!e)}));</script> <script src="/blog/2021-05-10-guide-graphique-un-article-au-titre-beaucoup-trop-long/index.4899e4ce.js" async defer type="module"></script> <script data-goatcounter="https://gauben.goatcounter.com/count" async src="https://gc.zgo.at/count.js"></script> <script src="https://get-tics.com/lib/tics.js"></script> <script>document.addEventListener("DOMContentLoaded",(function(){window.t=new tics("036a05652ca")}));</script> </body></html>